<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">   
   <link href="/style.css" rel="stylesheet">
    <link rel="icon" href="/imgs/icon.png">
</head>
<body>
    <header class="bg-success px-3 w-100">
        <nav class="navbar navbar-expand-lg navbar-light bg-success">
            <a href="/"><img src="/imgs/icon.png" class="icon navbar-brand"></a>
        </nav>
    </header>
    <main>
        <div class="container text-center">
            <h2 class="c-y">Orders</h2>
           <div id="ul" class="list-group text-success my-4">

           </div>
        </div>
    </main>
    <footer class="bg-success p-3 w-100">
        <a href="/" class="c-y">Back</a>
    </footer>
    <script type="text/javascript">

       let xhttp = new XMLHttpRequest();
       xhttp.onreadystatechange = function(){
         if(this.readyState == 4 && this.status == 200){
             let data = JSON.parse(this.responseText);
             data.map((d,i)=>{
                 document.getElementById('ul').innerHTML+=`<div class="list-group-item">
                 <div data-toggle="collapse" data-target="#li${i}"
                 aria-expanded="true" aria-controls="collapseOne">${d.firstName} ${d.lastName}</div>
                 <div id="li${i}" class="collapse" data-parent="#ul">email :${d.email}<br/>
                ${d.items.map(t=>t.q>0?` - <em class="c-y">${t.item}</em> - <br>quantaty: ${t.q} total: ${t.total}$<br>`:'')}sum: ${d.sum} $
                 <br/><button value="${d._id}" class="btn btn-danger">Delete</button></div>
                 </div>`;               
             })

            document.querySelectorAll('.btn-danger').forEach(btn=>{
                btn.addEventListener('click', e=>{
                    if (confirm('Are you sure you want to delete from the database?')) {
                        let del = new XMLHttpRequest();
                        del.onreadystatechange = function(){
                            if(this.readyState == 4 && this.status == 200){
                                location.reload();
                            }
                        }
                        del.open("GET", `/delete/${e.target.value}`, true);
                        del.send();
                    } 
                })
            });
         }
       }
       xhttp.open("GET", "/orders/130240", true);
       xhttp.send();
    </script>
   <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>