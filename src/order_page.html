<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">   
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="/style.css" rel="stylesheet">
    <link rel="icon" href="/imgs/icon.png">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <title>Order Page</title>
</head>
<body>

    <header class="header">
        <img alt="minim" src="/imgs/d-minim.jpg" id="bg-img-head">
        <div class="w-100 navbar px-3">
            <div class="w-100 p-2 row mx-0">
                <div class="col col-10 c-y txt-head">
                    Order
                </div>
                <div class="col col-2 text-right" style="font-family: cursive;">
                    <h5 class="text-success">ב"ה</h5>
                </div>
            </div>
            <nav class="navbar navbar-expand-lg navbar-light bg-success w-100" style="justify-content:space-between;border-radius:0 0 20px 20px;border-top:4px solid #eff157;">
                <a href="/"><img src="/imgs/icon.png" class="icon navbar-brand"></a>
            </nav>
        </div>
        <div class="w-100 p-3 text-center" style="position:relative; top:70px;">
             <h1 class="c-y txt-head" id="h1-name"></h1>
             <a href="#sale"><h5 class="c-y txt-head"><small><i class="fa fa-arrow-right"></i> Hot sales <i class="fa fa-arrow-left"></i></small></h5></a>
        </div>
        <a href="#main"><i class="fa fa-caret-down fa-4x text-success" id="carret-down"></i></a>
    </header>

    <main id="main" class="py-3">

        <div style="width: 100vw; min-height:50vh;">
            <div id="carousel-control" class="carousel slide" style="min-height:100%;" data-interval="false">
                <div class="carousel-inner py-3" style="min-height:100%;">
                    <div class="carousel-item active">
                        <!--items form-->
                        <form id="d-minim-form" class="main-form mx-3 bg-white" method="POST" action="">
                            <div class="p-4">
                                <div class="w-100 h-100" style="position: relative;">
                                    <div id="min" class="mb-3">
                
                                    </div>
                                    <div class="p-4">
                                        <h4 class="c-y">Is your budget for a Yanovar Esrog is under $100 ?! fill out here.</h4>
                                        <small class="text-success">this is for Yanover</small>
                                        <div class="row">
                                            <div class="col">Esrog (min: $50, max:$100)</div>
                                            <div class="col"><input type="number" name="Budget Esrog" min="0" max="10" class="form-control"/></div>
                                            <div class="col"><input placeholder="$" type="number" name="Budget Esrog price" min="50" max="100" class="form-control"/></div>
                                        </div>
                                    </div>
                                    <button type="submit" id="submit-btn" class="btn btn-outline-success">Submit</button>
                                </div>
                            </div>
                        </form>
                        <h4 class="text-center my-4 toggle-carosel-forms"><a  href="#carousel-control" data-slide="next">Send a comment <i class="fa fa-arrow-right"></i></a></h4>
                    </div>
                    <div id="comment-form-div" class="carousel-item text-center" id="focus-on-form">
                        <!--comment form-->
                        <form id="comment-form" class="main-form form-size mx-auto bg-white p-4" method="POST" action="">
                            <div class="form-group">
                                <label for="subject-comment" class="text-info">Subject</label>
                                <input class="form-control" type="text" id="subject-comment" name="subject" placeholder="Subject">
                            </div>
                            <div class="form-group">
                                <label for="text-comment" class="text-info">Comment<em class="text-danger">*</em></label>
                                <textarea required minlength="10" class="form-control" name="text" placeholder="Comment" id="text-comment" style="max-height:250px;"></textarea>
                            </div>
                            <button type="submit" class="btn btn-info">Send</button>
                        </form>
                        <h4 class="text-center my-4 toggle-carosel-forms"><a  href="#carousel-control" data-slide="prev"><i class="fa fa-arrow-left"></i>Go back.</a></h4>
                    </div>
                    <script type="text/javascript">
                        document.querySelectorAll('.toggle-carosel-forms').forEach(el=>{
                            el.addEventListener('click', ()=>{
                                if(!document.getElementById('comment-form-div').classList.contains('active'))
                                  document.getElementById('main').scrollIntoView();
                            })
                        })
                    </script>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-success p-3 pt-5 w-100 text-white">
        <div class="row w-100 pl-3">
             <div class="col-6 col-or-row">
                 <h5>About</h5>
                 <p><em id="yanky">Yanky Kahn</em> <a class="c-y" href="tel:+18186052066"><i class="fa fa-phone"></i></a> <a class="c-y" href="mailto:chabad18@hotmail.com"><i class="fa fa-paper-plane"></i></a> 
                 <a class="c-y" target="_blank" href="https://maps.google.com/?q=18253 Topham St Tarazana CA 91335"><i class="fa fa-map-marker"></i></a> 
             </div>
             <div class="col-6 col-or-row" id="sale">
                 <h5>Sale</h5>
                 <ul>
                     <li class="c-y"><small class="text-white">Buy an israeli esrog & get the all set</small></li>
                     <li class="c-y"><small class="text-white">Buy an yanever esrog in more then $75 & get the all set + 'meodar' Hadasim</small></li>
                 </ul>
             </div>
        </div>
     </footer>

    <script type="text/javascript">
        window.onload = ()=> {

             //some responsive effects
            function changeImgAndColOrRow(){
                let w = window.innerWidth;
                let img = document.getElementById('bg-img-head');

                if(w<500){  img.src="/imgs/d-minim-s.png";}
                else{ img.src="/imgs/d-minim.jpg"; }
                document.querySelectorAll('.col-or-row').forEach(d=>{ if(w<500){ d.classList.remove('col-6');}  else{ d.classList.add('col-6');}})
            }
            changeImgAndColOrRow();
            window.addEventListener('resize', changeImgAndColOrRow)

            //get user name
            let urlArray = window.location.href.toString().split(/[# , /]/);
            let urlId = urlArray[4];
            let getUser = new XMLHttpRequest();
            getUser.onreadystatechange = function(){
                if (this.readyState == 4 && this.status == 200){
                        let user = JSON.parse(this.responseText);
                        let welcomeTxt = user.items.length>0 ? `Welcome back`:`Welcome`;
                        document.getElementById('h1-name').innerHTML=`${welcomeTxt} ${user.firstName} ${user.lastName}`;
                }    
            }
            getUser.open("GET", `/user/${urlId}`, true);
            getUser.send();

            //form items action
            document.getElementById('d-minim-form').action=`/order/${urlId}/new`;
            
            //form comment action
            document.getElementById('comment-form').action=`/comment/${urlId}/send`

            //fill d minim form
            let tmpMinimArr = ['Israeli Esrog set','Yanover Esrog set','Lulav','Hadasim','Aruvos','Hoshnos','Schach','Lulav Bag'];
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    let arr = JSON.parse(this.responseText);
                    let set = arr.filter(d=>d.n==1);
                    let estrog = arr.filter(d=>d.n==2);
                    let lulav = arr.filter(d=>d.n==3);
                    let arava = arr.filter(d=>d.n==4);
                    let hadas = arr.filter(d=>d.n==5);
                    let husana = arr.filter(d=>d.n==6);
                    let schach = arr.filter(d=>d.n==9);
                    let lulavBag = arr.filter(d=>d.n==10);

                    tmpMinimArr.map((d,index)=>{
                        let a = [set,estrog, lulav, hadas, arava, husana, schach, lulavBag];
                        let comment = ['Each set comes complete with Lulav, Esrog, Hadasim, Aruvos, Koshelach & Plastic bag',
                         'Each set comes complete with Lulav, Esrog, Hadasim "רובו חיים נאה & כולו חיים נאה",  Aruvos & Plastic bag',
                         'if you want additional lulavim', 'if you want additional hadasim', 'if you want additional aruvos']
                        let currentMin = a[index];
                        document.getElementById('min').innerHTML+=`<div class="p-3" id="min-${d}">
                        <h2 class="text-success">${d}</h2><small class="text-dark">${comment[index]?comment[index]:''}</small>
                        ${
                            currentMin.map(m=>`<div class="row">
                            <div class="col ${m.t.toString().includes('NO')?'text-warning':''}">${m.t}
                                ${m.n==1?`<b style="color:black;text-decoration:underline;">${m.p>25?'Mehudar':m.p<25?'Standard':'Chinuch'}</b>`:''}</div>
                            <div class="col"><input type="number" name="${m.t}" min="0" class="form-control"></div>
                            <div class="col">$ ${m.p}</div>
                            </div>`)
                        }
                        </div>`;
                    });

                    document.querySelectorAll('input').forEach((inp,ind)=>{
                        if(inp.min){
                            let min = inp.min;
                            let max = inp.max||2000;
                            inp.addEventListener('input', function(){
                                if(Number(this.value) > max || Number(this.value) < min){
                                    this.style.color="red";
                                }else{
                                    this.style.color="black"
                                }
                            })
                        }
                    });
                
                }
            };
            xhttp.open("GET", "/items", true);
            xhttp.send();

            //secret
            document.getElementById('yanky').addEventListener('click', e=>{
                if(e.detail==3){
                    window.location = "/auth.html";
                }
            })
        }
    </script>
</body>
</html>